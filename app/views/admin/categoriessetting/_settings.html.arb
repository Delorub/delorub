active_admin_form_for :data, url: :admin_categoriessetting, method: :get do |ff|
  ff.inputs 'Список городов' do
    ff.input :city_id, as: :select, collection: Place.only_cities.map{|a| [a.name, a.id]},
      selected: selected_city.id, label: 'Города', include_blank: false, input_html: { class: 'category_settings_select_cities' }
    ff.input :settings_type, as: :select, collection: PlaceCategoriesSetting.settings_type.options,
      selected: settings_type, label: 'Тип', include_blank: false, input_html: { class: 'category_settings_type' }
  end
end
unless selected_city.blank?
    table class: 'index_table index' do
      thead do
        tr do
          th style: 'width: 10%' do
            'Название категории'
          end
          th 'H1'
          th 'Seo Title'
          th 'Seo KeyWords'
          th 'Seo Description'
          th style: 'width: 30%' do
           'Description'
          end
          th style: 'width: 5%'
        end
      end
      tbody do
        Category.order(:position).each_with_index do |category, index|
          city_setting = selected_city.categories_settings.where(category_id: category.id, settings_type: settings_type).first
          active_admin_form_for :settings, url: :change_category_settings_admin_places, method: :post, html: {id: "form#{category.id}"} do |f|
            tr class: index%2 == 0 ? 'odd' : 'even' do
              td b category.title
              td do
                hidden_field_tag :category_id, category.id
                hidden_field_tag :city_id, selected_city.id
                hidden_field_tag :settings_type, settings_type
                f.text_field :h1, form:"form#{category.id}", style: 'width:100%', value: city_setting.present? ? city_setting.settings.dig(:h1) : ''
              end
              td f.text_field :seo_title, form:"form#{category.id}", style: 'width:100%', value: city_setting.present? ? city_setting.settings.dig(:seo_title) : ''
              td f.text_area :seo_keywords, cols: 50, rows: 5, form:"form#{category.id}", style: 'width:100%', value: city_setting.present? ? city_setting.settings.dig(:seo_keywords) : ''
              td f.text_area :seo_description, cols: 50, rows: 5, form:"form#{category.id}", style: 'width:100%', value: city_setting.present? ? city_setting.settings.dig(:seo_description) : ''
              td f.text_area :description, id: "txt-area-#{category.id}", form:"form#{category.id}", value: city_setting.present? ? city_setting.settings.dig(:description) : '', class: 'ckeditor'
              td f.button 'Сохранить', class: 'btn_save_city_category'
            end
          end
        end
      end
    end
end
